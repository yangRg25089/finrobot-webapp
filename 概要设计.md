# 🧠 FinRobot Web 应用项目概要设计（V1.6）

## 🎯 项目目标

将 `FinRobot` 项目的 `tutorials_beginner` 和 `tutorials_advanced` 中的 `.ipynb` 策略脚本 Web 化，封装成一个支持图表可视化、参数输入、回测分析的前后端分离系统。

---

## 🧱 项目结构（方式1：单仓库）

```bash
finrobot-app/
├── backend/                    # FastAPI 后端
│   ├── main.py                 # FastAPI 启动入口
│   ├── routes/                 # 接口定义
│   ├── services/               # 策略统一调度器
│   ├── tutorials_wrapper/      # 策略脚本封装模块
│   └── static/                 # 图像资源目录（挂载为 /static）
│
├── frontend/                   # React + TailwindCSS 前端
└── README.md
```

---

## ⚙️ 后端技术栈

| 技术           | 用途说明                       |
| ------------ | -------------------------- |
| **FastAPI**  | 用于构建高性能 REST API           |
| **Pydantic** | 用于校验请求参数并自动生成类型安全文档        |
| **Uvicorn**  | 用于运行 FastAPI 应用的异步 Web 服务器 |

---

## ✅ 后端功能详解

### 📌 动态策略调用接口：`run_script(script_path, params)`

```python
import importlib

def run_script(script_path: str, params: dict) -> dict:
    try:
        module_path = f"tutorials_wrapper.{script_path.replace('/', '.').replace('.py', '')}"
        script_module = importlib.import_module(module_path)

        if not hasattr(script_module, "run"):
            raise ValueError(f"script {script_path} missing 'run(params)'")
        return script_module.run(params)

    except ModuleNotFoundError:
        raise ValueError(f"Unsupported script: {script_path}")
```

---

### 📌 示例策略封装：`sma_script.py`

```python
def run(params: dict) -> dict:
    symbol = params["symbol"]
    start = params["start_date"]
    end = params["end_date"]
    window = int(params.get("window", 20))

    image_filename = f"sma_{symbol}_{window}.png"
    image_path = f"/static/{image_filename}"

    return {
        "metrics": {
            "profit": 0.12,
            "drawdown": 0.03
        },
        "image_path": image_path
    }
```

---

### 📌 FastAPI 启动配置（挂载静态资源）

```python
from fastapi.staticfiles import StaticFiles
import os

app.mount("/static", StaticFiles(directory=os.path.abspath("backend/static")), name="static")
```

✅ 启动命令：

```bash
uvicorn backend.main:app --reload --port 8000
```

* `--reload`：修改代码后自动重启（开发阶段）
* `main:app`：指向你项目中定义的 FastAPI 对象

---

## ✅ 关系图总结

```
+---------------------+
|     Frontend        |
| (React + Tailwind)  |
+----------+----------+
           |
           | HTTP 请求 (JSON)
           ↓
+----------+----------+
|      FastAPI        | ← 路由、接口定义
| (用 Pydantic 校验)  |
+----------+----------+
           |
           ↓
+---------------------+
|   业务逻辑 / 策略模块  |
+---------------------+

由 Uvicorn 运行整个后端服务
```

---

## 💻 前端页面设计（React + Tailwind）

### ✅ 布局结构

* 顶部导航栏（策略切换 / 用户头像）
* 左侧 Sidebar 可收缩菜单
* 主体区域包含参数输入 + 图表展示

---

### ✅ 前端核心组件

| 文件                  | 说明          |
| ------------------- | ----------- |
| `Sidebar.tsx`       | 左边栏策略选择     |
| `Topbar.tsx`        | 顶部导航栏       |
| `scriptForm.tsx`  | 用户输入策略参数    |
| `ResultViewer.tsx`   | 显示后端返回图像或图表 |
| `usescriptApi.ts` | 请求封装与状态处理   |

---

## 🔁 通信流程图

```mermaid
graph LR
A[前端提交策略路径 + 参数] --> B[FastAPI 接口]
B --> C[动态导入模块]
C --> D[执行 run(params)]
D --> E[生成图表 + 回测结果]
E --> F[返回图路径 + JSON 指标]
F --> G[前端展示图像与数据]
```

---

## ✅ MVP 实现目标

* [x] 策略 `.ipynb` 转 `.py`
* [x] 封装 `run(params)` 函数
* [x] 动态模块加载
* [x] 图像生成与路径返回
* [x] React + Tailwind 前端基础页面
* [x] FastAPI 成功挂载静态目录
